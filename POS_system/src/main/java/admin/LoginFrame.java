package admin;

import java.util.logging.Level;
import java.util.logging.Logger;
import services.clientHandler;

public class LoginFrame extends javax.swing.JFrame {

  services.clientHandler authService;
  private String ip = "127.0.0.1";

  /**
   * Creates new form LoginFrame
   */
  public LoginFrame() {
    initComponents();
    app.Global.setAppIcon(this);
    authService = new services.clientHandler(this.ip);
  }

  public LoginFrame(String ip) {
    initComponents();
    app.Global.setAppIcon(this);
    authService = new services.clientHandler(this.ip);
    this.ip = ip;
  }

  /**
   * This method is called from within the constructor to initialize the form.
   * WARNING: Do NOT modify this code. The content of this method is always
   * regenerated by the Form Editor.
   */
  @SuppressWarnings("unchecked")
  // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
  private void initComponents() {

    pnlContainer = new javax.swing.JPanel();
    lblTitle = new javax.swing.JLabel();
    lblUsername = new javax.swing.JLabel();
    txtUsername = new javax.swing.JTextField();
    lblPassword = new javax.swing.JLabel();
    txtPassword = new javax.swing.JPasswordField();
    btnLogin = new javax.swing.JButton();
    lblItemImagePreview = new javax.swing.JLabel();

    setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
    setTitle("Login");
    setBackground(new java.awt.Color(255, 255, 255));
    setName(""); // NOI18N
    setPreferredSize(new java.awt.Dimension(410, 300));
    getContentPane().setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

    pnlContainer.setBackground(new java.awt.Color(255, 255, 255));
    pnlContainer.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

    lblTitle.setFont(lblTitle.getFont().deriveFont(lblTitle.getFont().getSize()+10f));
    lblTitle.setForeground(new java.awt.Color(25, 47, 157));
    pnlContainer.add(lblTitle, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, -1, -1));

    lblUsername.setLabelFor(txtUsername);
    lblUsername.setText("Username");
    pnlContainer.add(lblUsername, new org.netbeans.lib.awtextra.AbsoluteConstraints(40, 120, -1, -1));

    txtUsername.setBorder(javax.swing.BorderFactory.createMatteBorder(0, 0, 1, 0, new java.awt.Color(0, 0, 0)));
    txtUsername.addActionListener(new java.awt.event.ActionListener() {
      public void actionPerformed(java.awt.event.ActionEvent evt) {
        txtUsernameActionPerformed(evt);
      }
    });
    pnlContainer.add(txtUsername, new org.netbeans.lib.awtextra.AbsoluteConstraints(100, 117, 250, 20));

    lblPassword.setLabelFor(txtPassword);
    lblPassword.setText("Password");
    pnlContainer.add(lblPassword, new org.netbeans.lib.awtextra.AbsoluteConstraints(40, 170, -1, -1));

    txtPassword.setBorder(javax.swing.BorderFactory.createMatteBorder(0, 0, 1, 0, new java.awt.Color(0, 0, 0)));
    pnlContainer.add(txtPassword, new org.netbeans.lib.awtextra.AbsoluteConstraints(100, 167, 250, 20));

    btnLogin.setBackground(new java.awt.Color(25, 47, 157));
    btnLogin.setForeground(new java.awt.Color(255, 255, 255));
    btnLogin.setText("Log in");
    btnLogin.addActionListener(new java.awt.event.ActionListener() {
      public void actionPerformed(java.awt.event.ActionEvent evt) {
        btnLoginActionPerformed(evt);
      }
    });
    pnlContainer.add(btnLogin, new org.netbeans.lib.awtextra.AbsoluteConstraints(150, 220, -1, -1));

    lblItemImagePreview.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
    lblItemImagePreview.setIcon(new javax.swing.ImageIcon(getClass().getResource("/icons/8005091691_c52bb4ef-b5b1-4221-a5.png"))); // NOI18N
    lblItemImagePreview.setMaximumSize(new java.awt.Dimension(150, 150));
    lblItemImagePreview.setMinimumSize(new java.awt.Dimension(150, 150));
    lblItemImagePreview.setPreferredSize(new java.awt.Dimension(150, 150));
    pnlContainer.add(lblItemImagePreview, new org.netbeans.lib.awtextra.AbsoluteConstraints(110, 0, -1, 90));

    getContentPane().add(pnlContainer, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, 410, 300));

    getAccessibleContext().setAccessibleName("");

    pack();
    setLocationRelativeTo(null);
  }// </editor-fold>//GEN-END:initComponents

  private void btnLoginActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnLoginActionPerformed
    if (getValidFields()) {
      models.User user = new models.User();
      user.setUsername(txtUsername.getText());
      user.setPassword(new String(txtPassword.getPassword()));

      try {
        if (clientHandler.getAuth(user)) {
          new AdminFrame(this.ip).setVisible(true);
          this.dispose();
        } else {
          javax.swing.JOptionPane.showMessageDialog(null, "Invalid username or password", "Authentication Failed", javax.swing.JOptionPane.ERROR_MESSAGE);
        }
      } catch (ClassNotFoundException ex) {
        Logger.getLogger(LoginFrame.class.getName()).log(Level.SEVERE, null, ex);
      }
    }
  }//GEN-LAST:event_btnLoginActionPerformed

    private void txtUsernameActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtUsernameActionPerformed
      // TODO add your handling code here:
    }//GEN-LAST:event_txtUsernameActionPerformed

  private boolean getValidFields() {
    if (txtUsername.getText().isEmpty()) {
      javax.swing.JOptionPane.showMessageDialog(null, "Username is required", "Warning", javax.swing.JOptionPane.WARNING_MESSAGE);
      return false;
    } else if (new String(txtPassword.getPassword()).isEmpty()) {
      javax.swing.JOptionPane.showMessageDialog(null, "Password is required", "Warning", javax.swing.JOptionPane.WARNING_MESSAGE);
      return false;
    } else {
      return true;
    }
  }

  /**
   * @param args the command line arguments
   */
  public static void main(String args[]) {
    /* Set default theme */
    app.Global.setDefaultTheme();

    /* Create and display the form */
    java.awt.EventQueue.invokeLater(() -> {
      new LoginFrame().setVisible(true);
    });
  }

  // Variables declaration - do not modify//GEN-BEGIN:variables
  private javax.swing.JButton btnLogin;
  private javax.swing.JLabel lblItemImagePreview;
  private javax.swing.JLabel lblPassword;
  private javax.swing.JLabel lblTitle;
  private javax.swing.JLabel lblUsername;
  private javax.swing.JPanel pnlContainer;
  private javax.swing.JPasswordField txtPassword;
  private javax.swing.JTextField txtUsername;
  // End of variables declaration//GEN-END:variables
}
